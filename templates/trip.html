<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripsAI: Plan Your Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/lucide.js"
        onerror="console.error('Failed to load Lucide script');"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .bg-pattern {
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23e2e8f0" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm-10-2l2-2m-2 2l-2 2m2-2l2 2m-2-2l-2-2m-20-6h2v-2H6v2zm18 0h2v-2h-2v2zm20 0h2v-2h-2v2zM12 36h2v-2h-2v2zm18 0h2v-2h-2v2zm20 0h2v-2h-2v2zM6 48h2v-2H6v2zm18 0h2v-2h-2v2zm20 0h2v-2h-2v2z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
        }

        .form-screen {
            display: none;
        }

        .form-screen.active {
            display: block;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-slate-50 text-slate-800">

    <div class="flex-grow flex items-center justify-center p-4 sm:p-6 bg-pattern">
        <div class="w-full max-w-2xl mx-auto bg-white rounded-3xl shadow-2xl p-6 sm:p-10 border border-slate-200">
            <header class="text-center mb-8">
                <div
                    class="mx-auto inline-flex items-center space-x-2 text-indigo-600 bg-indigo-100 rounded-full px-4 py-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 18s-4-6-4-8a4 4 0 0 1 8 0c0 2-4 8-4 8z" />
                        <circle cx="12" cy="10" r="2" />
                        <path d="M8 22h8" />
                        <path d="M12 22v-4" />
                    </svg>
                    <span class="text-sm font-semibold">TripsAI</span>
                </div>
                <h1 class="mt-4 text-3xl sm:text-4xl font-extrabold text-slate-900">Plan Your Trip</h1>
                <p class="mt-2 text-base text-slate-500">Answer a few questions and let our AI create the perfect
                    itinerary for you.</p>
            </header>

            <form id="trip-form" class="space-y-6">
                <!-- Screen 1: Trip Details -->
                <div id="screen-details" class="form-screen active space-y-6">
                    <!-- New input field for source, as this is now required by the backend -->
                    <div>
                        <label for="source" class="block text-sm font-medium text-slate-700 mb-2">Source of Trip
                            Request</label>
                        <input type="text" id="source" name="source" placeholder="e.g., website, friend, social media"
                            required
                            class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label for="destination"
                            class="block text-sm font-medium text-slate-700 mb-2">Destination</label>
                        <input type="text" id="destination" name="destination" required
                            class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-colors">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div>
                            <label for="start-date" class="block text-sm font-medium text-slate-700 mb-2">Start
                                Date</label>
                            <input type="date" id="start-date" name="startDate" required
                                class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-colors">
                        </div>
                        <div>
                            <label for="end-date" class="block text-sm font-medium text-slate-700 mb-2">End Date</label>
                            <input type="date" id="end-date" name="endDate" required
                                class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-colors">
                        </div>
                    </div>
                    <div>
                        <label for="travelers" class="block text-sm font-medium text-slate-700 mb-2">Number of
                            Travelers</label>
                        <input type="number" id="travelers" name="travelers" value="1" min="1" required
                            class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-colors">
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button type="button" onclick="goToScreen('screen-interests')"
                            class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Screen 2: Interests -->
                <div id="screen-interests" class="form-screen space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold text-slate-800">What are you interested in?</h3>
                        <p class="text-sm text-slate-500 mt-1">Select all that apply.</p>
                        <div id="interests-container" class="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-4">
                            <!-- Interest cards will be rendered here -->
                        </div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button type="button" onclick="goToScreen('screen-details')"
                            class="px-6 py-2 text-slate-600 bg-slate-100 font-semibold rounded-full shadow-md hover:bg-slate-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500">
                            Back
                        </button>
                        <button type="button" onclick="goToScreen('screen-budget')"
                            class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Screen 3: Budget -->
                <div id="screen-budget" class="form-screen space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold text-slate-800">What's your budget per person?</h3>
                        <p class="text-sm text-slate-500 mt-1">This helps us tailor suggestions to your spending style.
                        </p>
                        <div class="mt-6">
                            <label for="budget-slider" class="block text-sm font-medium text-slate-700 mb-4">
                                Estimated Total Budget: <span id="budget-value"
                                    class="text-indigo-600 font-bold">₹50,000</span>
                            </label>
                            <input type="range" id="budget-slider" name="budget" min="10000" max="150000" value="50000"
                                step="1000"
                                class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer range-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button type="button" onclick="goToScreen('screen-interests')"
                            class="px-6 py-2 text-slate-600 bg-slate-100 font-semibold rounded-full shadow-md hover:bg-slate-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500">
                            Back
                        </button>
                        <button type="submit"
                            class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Generate My Itinerary
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal"
        class="fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300 ease-in-out opacity-0">
        <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-200 text-center max-w-sm w-full">
            <svg class="animate-spin h-12 w-12 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <h3 class="mt-4 text-xl font-bold text-slate-800">Generating Your Itinerary...</h3>
            <p class="mt-2 text-sm text-slate-500">This may take a moment. We are crafting a personalized plan just for
                you.</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal"
        class="fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-200 text-center max-w-sm w-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-x-circle text-red-500 mx-auto">
                <circle cx="12" cy="12" r="10" />
                <path d="m15 9-6 6" />
                <path d="m9 9 6 6" />
            </svg>
            <h3 id="error-title" class="mt-4 text-xl font-bold text-slate-800">Something went wrong!</h3>
            <p id="error-message" class="mt-2 text-sm text-slate-500">Please try again later or check your network
                connection.</p>
            <button id="close-modal-btn"
                class="mt-6 px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition-colors duration-200">
                OK
            </button>
        </div>
    </div>

    <!-- <script>
        const backendUrl = "http://127.0.0.1:8000/api/generate-itinerary";

        const screens = ['screen-details', 'screen-interests', 'screen-budget'];
        let currentScreenIndex = 0;

        function goToScreen(screenId) {
            screens.forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        const interestOptions = [
            { name: 'Sightseeing', icon: 'binoculars' },
            { name: 'Foodie', icon: 'utensils' },
            { name: 'Adventure', icon: 'mountain' },
            { name: 'Relaxation', icon: 'sun' },
            { name: 'History', icon: 'landmark' },
            { name: 'Art & Culture', icon: 'palette' },
            { name: 'Nightlife', icon: 'party-popper' },
            { name: 'Shopping', icon: 'shopping-bag' },
            { name: 'Nature', icon: 'leaf' },
        ];

        function renderInterestCards() {
            const container = document.getElementById('interests-container');
            container.innerHTML = interestOptions.map(option => `
                <label class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-300 cursor-pointer transition-colors hover:bg-slate-100">
                    <input type="checkbox" name="interests" value="${option.name}" class="sr-only peer">
                    <div class="w-12 h-12 text-indigo-500 flex items-center justify-center bg-indigo-100 rounded-full mb-2 peer-checked:bg-indigo-600 peer-checked:text-white transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-${option.icon}">
                            <title>${option.name}</title>
                        </svg>
                    </div>
                    <span class="text-sm font-medium text-slate-700 peer-checked:text-indigo-600">${option.name}</span>
                </label>
            `).join('');
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }

        function showErrorModal(message) {
            const errorModal = document.getElementById('error-modal');
            document.getElementById('error-message').textContent = message;
            errorModal.classList.remove('hidden');
        }

        function hideErrorModal() {
            const errorModal = document.getElementById('error-modal');
            errorModal.classList.add('hidden');
        }


        document.getElementById('trip-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const loadingModal = document.getElementById('loading-modal');
            loadingModal.classList.remove('hidden');
            loadingModal.classList.add('opacity-100');

            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            const start = new Date(startDateInput.value);
            const end = new Date(endDateInput.value);
            const durationInDays = (end - start) / (1000 * 60 * 60 * 24) + 1;

            const budgetSlider = document.getElementById('budget-slider');

            const destination = document.getElementById('destination').value;
            // Get the value from the new source input field
            const source = document.getElementById('source').value;

            const tripData = {
                destination: destination,
                startDate: startDateInput.value,
                endDate: endDateInput.value,
                duration: durationInDays,
                travelers: parseInt(document.getElementById('travelers').value),
                interests: Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value),
                budget: parseInt(budgetSlider.value),
                // Add the source to the data sent to the backend
                source: source
            };

            try {
                // Save the destination to local storage before redirecting
                localStorage.setItem('tripsAIDestination', destination);



                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(tripData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const itinerary = await response.json();
                localStorage.setItem('tripsAIItinerary', JSON.stringify(itinerary));
                // ✅ Save totalCost separately for payment.html
                localStorage.setItem('tripsAITotalCost', itinerary.totalCost);
                console.log("Saved total cost:", itinerary.totalCost);



                loadingModal.classList.remove('opacity-100');
                loadingModal.classList.add('hidden');

                window.location.href = 'itinerary.html';

            } catch (error) {
                console.error("Failed to generate itinerary:", error);
                loadingModal.classList.remove('opacity-100');
                loadingModal.classList.add('hidden');
                showErrorModal("Sorry, we couldn't generate your itinerary. Please try again later.");
            }
        });

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            renderInterestCards();

            const budgetSlider = document.getElementById('budget-slider');
            const budgetValue = document.getElementById('budget-value');
            budgetSlider.addEventListener('input', (event) => {
                const value = parseInt(event.target.value);
                budgetValue.textContent = `₹${value.toLocaleString('en-IN')}`;
            });

            document.getElementById('close-modal-btn').addEventListener('click', hideErrorModal);

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').setAttribute('min', today);
            document.getElementById('end-date').setAttribute('min', today);
        });

    </script> -->
    <script>
        const backendUrl = "http://127.0.0.1:8000/api/generate-itinerary";

        const screens = ['screen-details', 'screen-interests', 'screen-budget'];
        let currentScreenIndex = 0;

        function goToScreen(screenId) {
            screens.forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        const interestOptions = [
            { name: 'Sightseeing', icon: 'binoculars' },
            { name: 'Foodie', icon: 'utensils' },
            { name: 'Adventure', icon: 'mountain' },
            { name: 'Relaxation', icon: 'sun' },
            { name: 'History', icon: 'landmark' },
            { name: 'Art & Culture', icon: 'palette' },
            { name: 'Nightlife', icon: 'party-popper' },
            { name: 'Shopping', icon: 'shopping-bag' },
            { name: 'Nature', icon: 'leaf' },
        ];

        function renderInterestCards() {
            const container = document.getElementById('interests-container');
            container.innerHTML = interestOptions.map(option => `
            <label class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-300 cursor-pointer transition-colors hover:bg-slate-100">
                <input type="checkbox" name="interests" value="${option.name}" class="sr-only peer">
                <div class="w-12 h-12 text-indigo-500 flex items-center justify-center bg-indigo-100 rounded-full mb-2 peer-checked:bg-indigo-600 peer-checked:text-white transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-${option.icon}">
                        <title>${option.name}</title>
                    </svg>
                </div>
                <span class="text-sm font-medium text-slate-700 peer-checked:text-indigo-600">${option.name}</span>
            </label>
        `).join('');
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }

        function showErrorModal(message) {
            const errorModal = document.getElementById('error-modal');
            document.getElementById('error-message').textContent = message;
            errorModal.classList.remove('hidden');
        }

        function hideErrorModal() {
            const errorModal = document.getElementById('error-modal');
            errorModal.classList.add('hidden');
        }

        // --- FORM SUBMIT ---
        document.getElementById('trip-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const loadingModal = document.getElementById('loading-modal');
            loadingModal.classList.remove('hidden');
            loadingModal.classList.add('opacity-100');

            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            const start = new Date(startDateInput.value);
            const end = new Date(endDateInput.value);
            const durationInDays = (end - start) / (1000 * 60 * 60 * 24) + 1;

            const budgetSlider = document.getElementById('budget-slider');
            const destination = document.getElementById('destination').value;
            const source = document.getElementById('source').value;

            const tripData = {
                destination: destination,
                startDate: startDateInput.value,
                endDate: endDateInput.value,
                duration: durationInDays,
                travelers: parseInt(document.getElementById('travelers').value),
                interests: Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value),
                budget: parseInt(budgetSlider.value),
                source: source
            };

            try {
                // ✅ Save destination immediately (used in itinerary.html background)
                localStorage.setItem('tripsAIDestination', destination);

                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(tripData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const itinerary = await response.json();
                console.log("Full itinerary response:", itinerary);

                // ✅ Save whole itinerary
                localStorage.setItem('tripsAIItinerary', JSON.stringify(itinerary));

                // ✅ Save totalCost separately for payment.html
                if (itinerary.totalCost) {
                    localStorage.setItem('tripsAITotalCost', itinerary.totalCost);
                    console.log("Saved total cost:", itinerary.totalCost);
                } else {
                    console.warn("⚠️ totalCost missing in itinerary response!");
                }

                loadingModal.classList.remove('opacity-100');
                loadingModal.classList.add('hidden');

                window.location.href = 'itinerary.html';

            } catch (error) {
                console.error("Failed to generate itinerary:", error);
                loadingModal.classList.remove('opacity-100');
                loadingModal.classList.add('hidden');
                showErrorModal("Sorry, we couldn't generate your itinerary. Please try again later.");
            }
        });

        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            renderInterestCards();

            const budgetSlider = document.getElementById('budget-slider');
            const budgetValue = document.getElementById('budget-value');
            budgetSlider.addEventListener('input', (event) => {
                const value = parseInt(event.target.value);
                budgetValue.textContent = `₹${value.toLocaleString('en-IN')}`;
            });

            document.getElementById('close-modal-btn').addEventListener('click', hideErrorModal);

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').setAttribute('min', today);
            document.getElementById('end-date').setAttribute('min', today);
        });
    </script>

</body>

</html>